\hypertarget{eforth__vm_8cpp}{}\doxysection{src/eforth\+\_\+vm.cpp File Reference}
\label{eforth__vm_8cpp}\index{src/eforth\_vm.cpp@{src/eforth\_vm.cpp}}


e\+Forth Virtual Machine module  


{\ttfamily \#include \char`\"{}eforth\+\_\+vm.\+h\char`\"{}}\newline
Include dependency graph for eforth\+\_\+vm.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{eforth__vm_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
 \mbox{\hyperlink{namespaceEfVM}{Ef\+VM}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{eforth__vm_8cpp_afc09b15fce90b9e00aa7277e7edd5c4e}{Y\+I\+E\+L\+D\+\_\+\+P\+E\+R\+I\+OD}}~100
\item 
\#define \mbox{\hyperlink{eforth__vm_8cpp_ab225fd437247be81c502ebd3b4857465}{Y\+I\+E\+LD}}()
\item 
\#define \mbox{\hyperlink{eforth__vm_8cpp_ac7635cecf944d5bfcc89665c08022828}{OP}}(name)~\&\&L\+\_\+\#\#name          /$\ast$$\ast$ redefined for label address     $\ast$/
\item 
\#define \mbox{\hyperlink{eforth__vm_8cpp_a694d28437d830c2e82367a5b56ae5163}{\+\_\+X}}(n,  code)~L\+\_\+\#\#n\+: \{ \mbox{\hyperlink{eforth__vm_8h_a3254550e1d6d185f6b3e69b2d6468343}{D\+E\+B\+UG}}(\char`\"{}\%s\char`\"{},\#n); code; continue; \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{namespaceEfVM_aaaa9f256ad4e73f2885577923fa23447}{Ef\+V\+M\+::\+\_\+init}} ()
\item 
void \mbox{\hyperlink{namespaceEfVM_a1149487a9866fbd91d4ccaf57eab9ea6}{Ef\+V\+M\+::\+\_\+yield}} ()
\begin{DoxyCompactList}\small\item\em \begin{quote}
yield to interrupt service \end{quote}
\end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespaceEfVM_a2afadbdf0e72c8707edfebe583a5dfa6}{Ef\+V\+M\+::\+\_\+qrx}} ()
\begin{DoxyCompactList}\small\item\em \begin{quote}
( -- c ) fetch a char from console \end{quote}
\end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespaceEfVM_ad93fbce2cb609c605aa8df2355c8e16b}{Ef\+V\+M\+::\+\_\+txsto}} ()
\begin{DoxyCompactList}\small\item\em \begin{quote}
(c -- ) send a char to console \end{quote}
\end{DoxyCompactList}\item 
void \mbox{\hyperlink{namespaceEfVM_a04b479eed7bc0fa0b9c8600f47c04cba}{Ef\+V\+M\+::\+\_\+ummod}} ()
\begin{DoxyCompactList}\small\item\em (udl udh u -- ur uq) unsigned double divided by a single \end{DoxyCompactList}\item 
void \mbox{\hyperlink{eforth__vm_8cpp_ab96d3e1cfedd27d24fea512540b32a98}{vm\+\_\+init}} (P\+G\+M\+\_\+P rom, \mbox{\hyperlink{eforth__core_8h_aa63ef7b996d5487ce35a5a66601f3e73}{U8}} $\ast$data, void $\ast$io\+\_\+stream)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static Stream $\ast$ \mbox{\hyperlink{namespaceEfVM_aa5ac1bb7ff2e93de1df7e220797fc690}{Ef\+V\+M\+::io}}
\item 
int \mbox{\hyperlink{namespaceEfVM_a09d628000e6b3bb7306a3bc9c3299efe}{Ef\+V\+M\+::\+\_\+yield\+\_\+cnt}} = 0
\begin{DoxyCompactList}\small\item\em interrupt service throttle counter \end{DoxyCompactList}\end{DoxyCompactItemize}
\begin{Indent}\textbf{ VM registers}\par
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_a34e9492841c1a98e29286c41dcdac10b}{Ef\+V\+M\+::\+IP}}
\begin{DoxyCompactList}\small\item\em instruction pointer, IU is 16-\/bit, opcode is 8-\/bit \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_a4444ce01dd126290156b6339aedb281b}{Ef\+V\+M\+::\+PC}}
\begin{DoxyCompactList}\small\item\em program counter, IU is 16-\/bit \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a9def3ba25dadbb291ebaee373982a18c}{Ef\+V\+M\+::\+DS}}
\begin{DoxyCompactList}\small\item\em data stack pointer, Dr. Ting\textquotesingle{}s stack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a44c4b6ad0dc45ad811db233793ab9ba8}{Ef\+V\+M\+::\+RS}}
\begin{DoxyCompactList}\small\item\em return stack pointer, Dr. Ting\textquotesingle{}s rack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} \mbox{\hyperlink{namespaceEfVM_a0d508bfbdbd7a09dcd56a24e3b6cb169}{Ef\+V\+M\+::top}}
\begin{DoxyCompactList}\small\item\em A\+LU (i.\+e. cached top of stack value) \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} \mbox{\hyperlink{namespaceEfVM_a61aea862ab3bab556736663c844366c7}{Ef\+V\+M\+::rtop}}
\begin{DoxyCompactList}\small\item\em cached loop counter on return stack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_ad6bf1128d9ffa5007021ecabed123c74}{Ef\+V\+M\+::\+IR}}
\begin{DoxyCompactList}\small\item\em interrupt service routine \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}\textbf{ Memory Management Unit}\par
\begin{DoxyCompactItemize}
\item 
P\+G\+M\+\_\+P \mbox{\hyperlink{namespaceEfVM_a84f1ef51c831a00617756c690faa7194}{Ef\+V\+M\+::\+\_\+rom}}
\begin{DoxyCompactList}\small\item\em R\+OM, Forth word stored in Arduino Flash Memory. \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_aa63ef7b996d5487ce35a5a66601f3e73}{U8}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a9f60f81681173bda3e807653f946a6f0}{Ef\+V\+M\+::\+\_\+data}}
\begin{DoxyCompactList}\small\item\em R\+AM, memory block for user define dictionary. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}\textbf{ VM registers}\par
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_a34e9492841c1a98e29286c41dcdac10b}{Ef\+V\+M\+::\+IP}}
\begin{DoxyCompactList}\small\item\em instruction pointer, IU is 16-\/bit, opcode is 8-\/bit \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_a4444ce01dd126290156b6339aedb281b}{Ef\+V\+M\+::\+PC}}
\begin{DoxyCompactList}\small\item\em program counter, IU is 16-\/bit \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a9def3ba25dadbb291ebaee373982a18c}{Ef\+V\+M\+::\+DS}}
\begin{DoxyCompactList}\small\item\em data stack pointer, Dr. Ting\textquotesingle{}s stack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a44c4b6ad0dc45ad811db233793ab9ba8}{Ef\+V\+M\+::\+RS}}
\begin{DoxyCompactList}\small\item\em return stack pointer, Dr. Ting\textquotesingle{}s rack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} \mbox{\hyperlink{namespaceEfVM_a0d508bfbdbd7a09dcd56a24e3b6cb169}{Ef\+V\+M\+::top}}
\begin{DoxyCompactList}\small\item\em A\+LU (i.\+e. cached top of stack value) \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a149fe3b107a553d7f4a2fcf3adc02b6a}{DU}} \mbox{\hyperlink{namespaceEfVM_a61aea862ab3bab556736663c844366c7}{Ef\+V\+M\+::rtop}}
\begin{DoxyCompactList}\small\item\em cached loop counter on return stack \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_a5fd90490ca5b2ceb72bf8b2c89a9634b}{IU}} \mbox{\hyperlink{namespaceEfVM_ad6bf1128d9ffa5007021ecabed123c74}{Ef\+V\+M\+::\+IR}}
\begin{DoxyCompactList}\small\item\em interrupt service routine \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}\textbf{ Memory Management Unit}\par
\begin{DoxyCompactItemize}
\item 
P\+G\+M\+\_\+P \mbox{\hyperlink{namespaceEfVM_a84f1ef51c831a00617756c690faa7194}{Ef\+V\+M\+::\+\_\+rom}}
\begin{DoxyCompactList}\small\item\em R\+OM, Forth word stored in Arduino Flash Memory. \end{DoxyCompactList}\item 
\mbox{\hyperlink{eforth__core_8h_aa63ef7b996d5487ce35a5a66601f3e73}{U8}} $\ast$ \mbox{\hyperlink{namespaceEfVM_a9f60f81681173bda3e807653f946a6f0}{Ef\+V\+M\+::\+\_\+data}}
\begin{DoxyCompactList}\small\item\em R\+AM, memory block for user define dictionary. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}


\doxysubsection{Detailed Description}
e\+Forth Virtual Machine module 

Revision Note\+: Threading model evolution 202212 Ef\+V\+M\+Sub module -\/ vtable subroutine calling 202301 indirect threading -\/ computed label jumping 202302 direct threading -\/ opcode =$>$ code(); continue = \$\+N\+E\+XT 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{eforth__vm_8cpp_afc09b15fce90b9e00aa7277e7edd5c4e}\label{eforth__vm_8cpp_afc09b15fce90b9e00aa7277e7edd5c4e}} 
\index{eforth\_vm.cpp@{eforth\_vm.cpp}!YIELD\_PERIOD@{YIELD\_PERIOD}}
\index{YIELD\_PERIOD@{YIELD\_PERIOD}!eforth\_vm.cpp@{eforth\_vm.cpp}}
\doxysubsubsection{\texorpdfstring{YIELD\_PERIOD}{YIELD\_PERIOD}}
{\footnotesize\ttfamily \#define Y\+I\+E\+L\+D\+\_\+\+P\+E\+R\+I\+OD~100}

\mbox{\Hypertarget{eforth__vm_8cpp_ab225fd437247be81c502ebd3b4857465}\label{eforth__vm_8cpp_ab225fd437247be81c502ebd3b4857465}} 
\index{eforth\_vm.cpp@{eforth\_vm.cpp}!YIELD@{YIELD}}
\index{YIELD@{YIELD}!eforth\_vm.cpp@{eforth\_vm.cpp}}
\doxysubsubsection{\texorpdfstring{YIELD}{YIELD}}
{\footnotesize\ttfamily \#define Y\+I\+E\+LD(\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespaceEfVM_ad6bf1128d9ffa5007021ecabed123c74}{IR}} \&\& ++\mbox{\hyperlink{namespaceEfVM_a09d628000e6b3bb7306a3bc9c3299efe}{\_yield\_cnt}} > \mbox{\hyperlink{eforth__vm_8cpp_afc09b15fce90b9e00aa7277e7edd5c4e}{YIELD\_PERIOD}}) \{ \(\backslash\)}
\DoxyCodeLine{        \_yield\_cnt = 0;                       \(\backslash\)}
\DoxyCodeLine{        \_yield();                             \(\backslash\)}
\DoxyCodeLine{    \}}

\end{DoxyCode}
\mbox{\Hypertarget{eforth__vm_8cpp_ac7635cecf944d5bfcc89665c08022828}\label{eforth__vm_8cpp_ac7635cecf944d5bfcc89665c08022828}} 
\index{eforth\_vm.cpp@{eforth\_vm.cpp}!OP@{OP}}
\index{OP@{OP}!eforth\_vm.cpp@{eforth\_vm.cpp}}
\doxysubsubsection{\texorpdfstring{OP}{OP}}
{\footnotesize\ttfamily \#define OP(\begin{DoxyParamCaption}\item[{}]{name }\end{DoxyParamCaption})~\&\&L\+\_\+\#\#name          /$\ast$$\ast$ redefined for label address     $\ast$/}

e\+Forth virtual machine outer interpreter (single-\/step) execution unit \begin{DoxyReturn}{Returns}
0 -\/ exit Note\+: vm\+\_\+outer -\/ computed label jumps (25\% faster than subroutine calls) continue in \mbox{\hyperlink{eforth__vm_8cpp_a694d28437d830c2e82367a5b56ae5163}{\+\_\+\+X()}} macro behaves as \$\+N\+E\+XT 
\end{DoxyReturn}
\mbox{\Hypertarget{eforth__vm_8cpp_a694d28437d830c2e82367a5b56ae5163}\label{eforth__vm_8cpp_a694d28437d830c2e82367a5b56ae5163}} 
\index{eforth\_vm.cpp@{eforth\_vm.cpp}!\_X@{\_X}}
\index{\_X@{\_X}!eforth\_vm.cpp@{eforth\_vm.cpp}}
\doxysubsubsection{\texorpdfstring{\_X}{\_X}}
{\footnotesize\ttfamily \#define \+\_\+X(\begin{DoxyParamCaption}\item[{}]{n,  }\item[{}]{code }\end{DoxyParamCaption})~L\+\_\+\#\#n\+: \{ \mbox{\hyperlink{eforth__vm_8h_a3254550e1d6d185f6b3e69b2d6468343}{D\+E\+B\+UG}}(\char`\"{}\%s\char`\"{},\#n); code; continue; \}}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{eforth__vm_8cpp_ab96d3e1cfedd27d24fea512540b32a98}\label{eforth__vm_8cpp_ab96d3e1cfedd27d24fea512540b32a98}} 
\index{eforth\_vm.cpp@{eforth\_vm.cpp}!vm\_init@{vm\_init}}
\index{vm\_init@{vm\_init}!eforth\_vm.cpp@{eforth\_vm.cpp}}
\doxysubsubsection{\texorpdfstring{vm\_init()}{vm\_init()}}
{\footnotesize\ttfamily void vm\+\_\+init (\begin{DoxyParamCaption}\item[{P\+G\+M\+\_\+P}]{rom,  }\item[{\mbox{\hyperlink{eforth__core_8h_aa63ef7b996d5487ce35a5a66601f3e73}{U8}} $\ast$}]{data,  }\item[{void $\ast$}]{io\+\_\+stream }\end{DoxyParamCaption})}


\begin{DoxyItemize}
\item resetting user variables
\end{DoxyItemize}